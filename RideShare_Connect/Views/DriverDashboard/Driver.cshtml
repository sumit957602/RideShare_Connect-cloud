@model RideShare_Connect.ViewModels.DriverDashboardViewModel
@using System.Linq
@{
    ViewData["Title"] = "Driver Dashboard";
}

<head>
    <link rel="stylesheet" href="~/css/driver.css" asp-append-version="true" />
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand fs-4" href="#">
                <i class="bi bi-car-front-fill me-2" style="color: var(--secondary-color);"></i>RideShare Connect
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav ms-auto">

                    <li class="nav-item">
                        <a class="nav-link active" href="#">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../../DriverFinancialDashboard/DriverFinance">Payments & Finance</a>
                    </li>
                </ul>
                <div class="dropdown ms-lg-3">
                    <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="/images/default-profile.png" alt="" width="32" height="32" class="rounded-circle me-2" />
                        <strong>@Model.Driver?.FullName</strong>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end text-small shadow" aria-labelledby="dropdownUser1">
                        <li><a class="dropdown-item" href="#">Profile</a></li>
                        <li><hr class="dropdown-divider" /></li>
                        <li>
                            <form asp-controller="UserAccount" asp-action="Logout" method="post" class="d-inline">
                                <button type="submit" class="dropdown-item">Sign out</button>
                            </form>
                        </li>
                    </ul>


                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow-1 py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title mb-3">Driver Menu</h5>
                            <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                                <button class="nav-link active text-start" data-bs-toggle="pill" data-bs-target="#v-pills-overview" type="button" role="tab"><i class="bi bi-speedometer2 me-2"></i>Overview</button>
                                <button class="nav-link text-start" data-bs-toggle="pill" data-bs-target="#v-pills-profile" type="button" role="tab"><i class="bi bi-person-badge-fill me-2"></i>Driver Profile</button>
                                <button class="nav-link text-start" data-bs-toggle="pill" data-bs-target="#v-pills-vehicles" type="button" role="tab"><i class="bi bi-car-front-fill me-2"></i>My Vehicles</button>
                                <button class="nav-link text-start" data-bs-toggle="pill" data-bs-target="#v-pills-createdrides" type="button" role="tab"><i class="bi bi-list-ul me-2"></i>Created Rides</button>
                                <button class="nav-link text-start" data-bs-toggle="pill" data-bs-target="#v-pills-acceptedrides" type="button" role="tab"><i class="bi bi-check-circle-fill me-2"></i>Accepted Rides</button>
                                <button class="nav-link text-start" data-bs-toggle="pill" data-bs-target="#v-pills-activerides" type="button" role="tab"><i class="bi bi-play-circle-fill me-2"></i>Active Rides</button>
                                <button class="nav-link text-start" data-bs-toggle="pill" data-bs-target="#v-pills-cancelledrides" type="button" role="tab"><i class="bi bi-x-circle-fill me-2"></i>Cancelled Rides</button>
                                <button class="nav-link text-start" data-bs-toggle="pill" data-bs-target="#v-pills-totalrides" type="button" role="tab"><i class="bi bi-collection me-2"></i>Total Rides</button>
                                <button class="nav-link text-start" data-bs-toggle="pill" data-bs-target="#v-pills-ratings" type="button" role="tab"><i class="bi bi-star-fill me-2"></i>Ratings & Reviews</button>
                                <div class="p-3 mt-4">
                                    <a class="btn btn-primary w-100" asp-action="CreateRide">
                                        <i class="bi bi-plus-circle-fill me-2"></i>Create a New Ride
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-9">
                    <div class="tab-content" id="v-pills-tabContent">
                        <div class="tab-pane fade show active" id="v-pills-overview" role="tabpanel">
                            <h4 class="mb-4">Driver Overview</h4>
                            <div class="row g-4">
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body d-flex align-items-center">
                                            <div class="icon bg-warning-subtle text-warning me-3"><i class="bi bi-star-fill"></i></div>
                                            <div>
                                                <h5 class="mb-0">@Model.AverageRating.ToString("0.0")</h5>
                                                <p class="text-muted mb-0">Overall Rating</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body d-flex align-items-center">
                                            <div class="icon bg-success-subtle text-success me-3"><i class="bi bi-wallet-fill"></i></div>
                                            <div>
                                                <h5 class="mb-0">@Model.WalletBalance.ToString("C")</h5>
                                                <p class="text-muted mb-0">Wallet Balance</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body d-flex align-items-center">
                                            <div class="icon bg-primary-subtle text-primary me-3"><i class="bi bi-cash-stack"></i></div>
                                            <div>
                                                <h5 class="mb-0">@Model.TotalEarnings.ToString("C")</h5>
                                                <p class="text-muted mb-0">Total Earnings</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row g-4 mt-1">
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body d-flex align-items-center">
                                            <div class="icon bg-info-subtle text-info me-3"><i class="bi bi-car-front-fill"></i></div>
                                            <div>
                                                <h5 class="mb-0">@Model.VehicleCount</h5>
                                                <p class="text-muted mb-0">My Vehicles</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body d-flex align-items-center">
                                            <div class="icon bg-secondary-subtle text-secondary me-3"><i class="bi bi-list-ul"></i></div>
                                            <div>
                                                <h5 class="mb-0">@Model.CreatedRidesCount</h5>
                                                <p class="text-muted mb-0">Created Rides</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body d-flex align-items-center">
                                            <div class="icon bg-success-subtle text-success me-3"><i class="bi bi-check-circle-fill"></i></div>
                                            <div>
                                                <h5 class="mb-0">@Model.AcceptedRidesCount</h5>
                                                <p class="text-muted mb-0">Accepted Rides</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body d-flex align-items-center">
                                            <div class="icon bg-primary-subtle text-primary me-3"><i class="bi bi-play-circle-fill"></i></div>
                                            <div>
                                                <h5 class="mb-0">@Model.ActiveRidesCount</h5>
                                                <p class="text-muted mb-0">Active Rides</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body d-flex align-items-center">
                                            <div class="icon bg-danger-subtle text-danger me-3"><i class="bi bi-x-circle-fill"></i></div>
                                            <div>
                                                <h5 class="mb-0">@Model.CancelledRidesCount</h5>
                                                <p class="text-muted mb-0">Cancelled Rides</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body d-flex align-items-center">
                                            <div class="icon bg-dark-subtle text-dark me-3"><i class="bi bi-collection"></i></div>
                                            <div>
                                                <h5 class="mb-0">@Model.TotalRidesCount</h5>
                                                <p class="text-muted mb-0">Total Rides</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="v-pills-profile" role="tabpanel">
                            <h4 class="mb-4">Driver Profile</h4>
                            <div class="card">
                                <div class="card-body">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item"><strong>Name:</strong> @Model.Driver?.FullName</li>
                                        <li class="list-group-item"><strong>Email:</strong> @Model.Driver?.Email</li>
                                        <li class="list-group-item"><strong>Phone:</strong> @Model.Driver?.PhoneNumber</li>
                                        <li class="list-group-item"><strong>License Number:</strong> @Model.DriverProfile?.LicenseNumber</li>
                                        <li class="list-group-item"><strong>Background Check:</strong> @Model.DriverProfile?.BackgroundCheckStatus</li>
                                        <li class="list-group-item"><strong>Experience:</strong> @Model.DriverProfile?.DrivingExperienceYears years</li>
                                        <li class="list-group-item"><strong>Date of Birth:</strong> @(Model.DriverProfile != null ? Model.DriverProfile.DOB.ToString("yyyy-MM-dd") : "")</li>
                                    </ul>
                                    <div class="mt-3 text-end">
                                        <a asp-action="EditProfile" class="btn btn-primary">Update Profile</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="v-pills-vehicles" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="mb-0">My Vehicles</h4>
                                <a asp-action="AddVehicle" class="btn btn-primary"><i class="bi bi-plus-circle-fill me-2"></i>Register New Vehicle</a>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead><tr><th>Vehicle</th><th>Type</th><th>Verification Status</th><th>Actions</th></tr></thead>
                                            <tbody>
                                                @if (Model.Vehicles.Any())
                                                {
                                                    foreach (var v in Model.Vehicles)
                                                    {
                                                        <tr>
                                                            <td>@v.LicensePlate (@v.Model)</td>
                                                            <td>@v.VehicleType</td>
                                                            <td><span class="badge bg-secondary">@v.VerificationStatus</span></td>
                                                            <td>
                                                                <a asp-action="EditVehicle" asp-route-id="@v.Id" class="btn btn-sm btn-primary me-2">Edit</a>
                                                                <form asp-action="DeleteVehicle" asp-route-id="@v.Id" method="post" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this vehicle?');">
                                                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                                                </form>
                                                            </td>
                                                        </tr>
                                                    }
                                                }
                                                else
                                                {
                                                    <tr><td colspan="4">No vehicles registered.</td></tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="v-pills-createdrides" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="mb-0">Created Rides</h4>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead><tr><th>Route</th><th>Departure</th><th>Status</th><th>Seats</th><th>Actions</th></tr></thead>
                                            <tbody>
                                                @if (Model.CreatedRides.Any())
                                                {
                                                    foreach (var ride in Model.CreatedRides)
                                                    {
                                                        <tr>
                                                            <td>@ride.Origin <i class="bi bi-arrow-right"></i> @ride.Destination</td>
                                                            <td>@ride.DepartureTime.ToString("yyyy-MM-dd HH:mm")</td>
                                                            <td><span class="badge bg-secondary">@ride.Status</span></td>
                                                            <td>@ride.AvailableSeats/@ride.TotalSeats</td>
                                                            <td>
                                                                <a asp-action="ViewRide" asp-route-id="@ride.Id" class="btn btn-sm btn-info me-2">View</a>
                                                                <a asp-action="EditRide" asp-route-id="@ride.Id" class="btn btn-sm btn-primary me-2">Edit</a>
                                                                <form asp-action="DeleteRide" asp-route-id="@ride.Id" method="post" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this ride?');">
                                                                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                                                                </form>
                                                            </td>
                                                        </tr>
                                                    }
                                                }
                                                else
                                                {
                                                    <tr><td colspan="4">No rides created.</td></tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="v-pills-acceptedrides" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="mb-0">Accepted Rides</h4>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead><tr><th>Passenger ID</th><th>Route</th><th>Seats</th><th>Pickup</th><th>Drop</th><th>Total Fare</th><th>Actions</th></tr></thead>
                                            <tbody>
                                                @if (Model.AcceptedRideBookings.Any(b => b.Status == "Pending"))
                                                {
                                                    foreach (var booking in Model.AcceptedRideBookings.Where(b => b.Status == "Pending"))
                                                    {
                                                        <tr>
                                                            <td>@booking.PassengerId</td>
                                                            <td>@booking.Origin <i class="bi bi-arrow-right"></i> @booking.Destination</td>
                                                            <td>@booking.BookedSeats</td>
                                                            <td>@booking.PickupLocation</td>
                                                            <td>@booking.DropLocation</td>
                                                            <td>@( (booking.BookedSeats * booking.PricePerSeat * booking.DistanceKm).ToString("C") )</td>
                                                            <td>
                                                                <form asp-action="StartRide" asp-route-id="@booking.BookingId" method="post" class="d-inline">
                                                                    @Html.AntiForgeryToken()
                                                                    <button type="submit" class="btn btn-sm btn-success me-2">Start Ride</button>
                                                                </form>
                                                                <form asp-action="CancelRide" asp-route-id="@booking.BookingId" method="post" class="d-inline" onsubmit="return confirm('Are you sure you want to cancel this ride?');">
                                                                    @Html.AntiForgeryToken()
                                                                    <button type="submit" class="btn btn-sm btn-danger">Cancel Ride</button>
                                                                </form>
                                                            </td>
                                                        </tr>
                                                    }
                                                }
                                                else
                                                {
                                                    <tr><td colspan="7">No accepted rides.</td></tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                            </div>
                        </div>
                    </div>
                        <div class="tab-pane fade" id="v-pills-activerides" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="mb-0">Active Rides</h4>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead><tr><th>Passenger ID</th><th>Route</th><th>Seats</th><th>Pickup</th><th>Drop</th><th>Total Fare</th><th>Status</th><th>Actions</th></tr></thead>
                                            <tbody>
                                                @if (Model.AcceptedRideBookings.Any(b => b.Status == "Ongoing"))
                                                {
                                                    foreach (var booking in Model.AcceptedRideBookings.Where(b => b.Status == "Ongoing"))
                                                    {
                                                        <tr>
                                                            <td>@booking.PassengerId</td>
                                                            <td>@booking.Origin <i class="bi bi-arrow-right"></i> @booking.Destination</td>
                                                            <td>@booking.BookedSeats</td>
                                                            <td>@booking.PickupLocation</td>
                                                            <td>@booking.DropLocation</td>
                                                            <td>@( (booking.BookedSeats * booking.PricePerSeat * booking.DistanceKm).ToString("C") )</td>
                                                            <td>@booking.Status</td>
                                                            <td>
                                                                <a asp-action="CompleteRide" asp-route-id="@booking.BookingId" class="btn btn-sm btn-success me-2">Complete Ride</a>
                                                                <form asp-action="CancelRide" asp-route-id="@booking.BookingId" method="post" class="d-inline" onsubmit="return confirm('Are you sure you want to cancel this ride?');">
                                                                    @Html.AntiForgeryToken()
                                                                    <button type="submit" class="btn btn-sm btn-danger">Cancel Ride</button>
                                                                </form>
                                                            </td>
                                                        </tr>
                                                    }
                                                }
                                                else
                                                {
                                                    <tr><td colspan="8">No active rides.</td></tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="v-pills-cancelledrides" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="mb-0">Cancelled Rides</h4>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead><tr><th>Passenger ID</th><th>Route</th><th>Seats</th><th>Pickup</th><th>Drop</th><th>Total Fare</th><th>Status</th></tr></thead>
                                            <tbody>
                                                @if (Model.AcceptedRideBookings.Any(b => b.Status == "Cancelled"))
                                                {
                                                    foreach (var booking in Model.AcceptedRideBookings.Where(b => b.Status == "Cancelled"))
                                                    {
                                                        <tr>
                                                            <td>@booking.PassengerId</td>
                                                            <td>@booking.Origin <i class="bi bi-arrow-right"></i> @booking.Destination</td>
                                                            <td>@booking.BookedSeats</td>
                                                            <td>@booking.PickupLocation</td>
                                                            <td>@booking.DropLocation</td>
                                                            <td>@( (booking.BookedSeats * booking.PricePerSeat * booking.DistanceKm).ToString("C") )</td>
                                                            <td>@booking.Status</td>
                                                        </tr>
                                                    }
                                                }
                                                else
                                                {
                                                    <tr><td colspan="7">No cancelled rides.</td></tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="v-pills-totalrides" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="mb-0">Total Rides</h4>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead><tr><th>Passenger ID</th><th>Route</th><th>Seats</th><th>Pickup</th><th>Drop</th><th>Total Fare</th><th>Status</th></tr></thead>
                                            <tbody>
                                                @if (Model.AcceptedRideBookings.Any())
                                                {
                                                    foreach (var booking in Model.AcceptedRideBookings)
                                                    {
                                                        <tr>
                                                            <td>@booking.PassengerId</td>
                                                            <td>@booking.Origin <i class="bi bi-arrow-right"></i> @booking.Destination</td>
                                                            <td>@booking.BookedSeats</td>
                                                            <td>@booking.PickupLocation</td>
                                                            <td>@booking.DropLocation</td>
                                                            <td>@( (booking.BookedSeats * booking.PricePerSeat * booking.DistanceKm).ToString("C") )</td>
                                                            <td>@booking.Status</td>
                                                        </tr>
                                                    }
                                                }
                                                else
                                                {
                                                    <tr><td colspan="7">No rides found.</td></tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <div class="tab-pane fade" id="v-pills-ratings" role="tabpanel">
                        <h4 class="mb-4">Passenger Ratings & Reviews</h4>
                        <div class="card">
                            <div class="card-body">
                                <div class="text-center mb-3">
                                        <h2 class="display-4 fw-bold">@Model.AverageRating.ToString("0.0") <i class="bi bi-star-fill text-warning"></i></h2>
                                    </div>
                                    <h5 class="mt-4">Recent Feedback</h5>
                                    @if (Model.RecentRatings.Any())
                                    {
                                        <ul class="list-group list-group-flush">
                                            @foreach (var r in Model.RecentRatings)
                                            {
                                                <li class="list-group-item"><strong>@r.Rating <i class="bi bi-star-fill text-warning"></i>:</strong> @r.Review</li>
                                            }
                                        </ul>
                                    }
                                    else
                                    {
                                        <p>No ratings available.</p>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-4"><h5><i class="bi bi-car-front-fill me-2" style="color: var(--secondary-color);"></i>RideShare Connect</h5><p>Your trusted platform for safe, comfortable, and affordable shared rides.</p></div>
                <div class="col-lg-2 col-md-4 col-6"><h5>Quick Links</h5><ul class="list-unstyled"><li class="mb-2"><a href="#">About Us</a></li><li class="mb-2"><a href="#">Contact</a></li></ul></div>
                <div class="col-lg-3 col-md-4 col-6"><h5>Legal</h5><ul class="list-unstyled"><li class="mb-2"><a href="#">Privacy Policy</a></li><li class="mb-2"><a href="#">Terms of Service</a></li></ul></div>
                <div class="col-lg-3 col-md-4"><h5>Contact Us</h5><ul class="list-unstyled"><li class="mb-2"><i class="bi bi-geo-alt-fill me-2"></i> 123 Connect Ave, Patna</li><li class="mb-2"><i class="bi bi-envelope-fill me-2"></i> contact@rideshareconnect.com</li></ul></div>
            </div>
            <hr class="my-4" style="border-color: rgba(255,255,255,0.2);"><div class="text-center"><p>&copy; 2025 RideShare Connect. All Rights Reserved.</p></div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <partial name="_ValidationScriptsPartial" />
</body>
</html>
